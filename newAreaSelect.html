<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
  <title>下属行政区查询</title>
  <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
  <style type="text/css">
    html,
    body,
    #container {
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="container"></div>

  <div class="input-card">
    <h4>下属行政区查询</h4>
    <div class="input-item">
      <div class="input-item-prepend"><span class="input-item-text">省市区</span></div>
      <select id='province' style="width:100px" onchange='search(this)'></select>
    </div>
    <div class="input-item">
      <div class="input-item-prepend"><span class="input-item-text">地级市</span></div>
      <select id='city' style="width:100px" onchange='search(this)'></select>
    </div>
    <div class="input-item">
      <div class="input-item-prepend"><span class="input-item-text">区县</span></div>
      <select id='district' style="width:100px" onchange='search(this)'></select>
    </div>
    <div class="input-item">
      <div class="input-item-prepend"><span class="input-item-text">街道</span></div>
      <select id='street' style="width:100px" onchange='setCenter(this)'></select>
    </div>
  </div>
  <script type="text/javascript"
    src="//webapi.amap.com/maps?v=2.0&key=09622561b7c5ce7ccfbeec6a1d24694f&plugin=AMap.DistrictSearch"></script>
  <script type="text/javascript">
    var map, district, polygons = [],
      citycode;
    let allDistrictList = [];
    var citySelect = document.getElementById('city');
    var districtSelect = document.getElementById('district');
    var areaSelect = document.getElementById('street');

    map = new AMap.Map('container', {
      center: [116.30946, 39.937629],
      zoom: 3
    });
    //行政区划查询
    var opts = {
      subdistrict: 1, //返回下一级行政区
      showbiz: false //最后一级返回街道信息
    };
    district = new AMap.DistrictSearch(opts); //注意：需要使用插件同步下发功能才能这样直接使用
    district.search('中国', function (status, result) {
      if (status == 'complete') {
        allDistrictList = result.districtList[0].districtList;
        // getData(result.districtList[0]);
        console.log(allDistrictList);
        // allDistrictList.forEach(item => {
        //   // console.log(item);
        //   search(item)
        // });
        for(let i=0,l=allDistrictList.length;i<l;i++){
          search(allDistrictList[i])
        }
        // search
      }
    });

    function getData(data, level) {
      // console.log(data, level);
      var bounds = data.boundaries;
      if (bounds) {
        for (var i = 0, l = bounds.length; i < l; i++) {
          var polygon = new AMap.Polygon({
            map: map,
            strokeWeight: 1, //边线宽度
            strokeColor: '#0091ea', //边线颜色
            fillColor: '#80d8ff',
            fillOpacity: 0.2,
            path: bounds[i] // 轮廓点坐标数组
          });
          polygons.push(polygon);
        }
        // map.setFitView(); //地图自适应
      }

      //清空下一级别的下拉列表
      // if (level === 'province') {
      //   citySelect.innerHTML = ''; //清除 市
      //   districtSelect.innerHTML = ''; //清除区县
      //   areaSelect.innerHTML = ''; //清除街道
      // } else if (level === 'city') {
      //   districtSelect.innerHTML = ''; //清除区县
      //   areaSelect.innerHTML = ''; //清除街道
      // } else if (level === 'district') {
      //   areaSelect.innerHTML = ''; //清除街道
      // }

      // var subList = data.districtList; //子级区域列表
      // if (subList) {
      //   var contentSub = new Option('--请选择--'); //hack方法 => <option>--请选择--</option>
      //   var curlevel = subList[0].level; //当前等级
      //   var curList = document.querySelector('#' + curlevel);
      //   curList.add(contentSub); //hack方法 给Select增加option
      //   for (var i = 0, l = subList.length; i < l; i++) {
      //     var name = subList[i].name;
      //     var levelSub = subList[i].level;
      //     var cityCode = subList[i].citycode;
      //     contentSub = new Option(name);
      //     contentSub.setAttribute("value", levelSub);
      //     contentSub.center = subList[i].center; //为option 增加属性 （竟然还有这种增加属性的方法，nb）
      //     contentSub.adcode = subList[i].adcode; //为option 增加属性 （之前的option是通过new 的Ojb，所以可以直接把option当作对象来增加属性）
      //     curList.add(contentSub);
      //   }
      // }

    }

    function search(obj) { //obj为当前Element
      //清除地图上所有覆盖物
      // for (var i = 0, l = polygons.length; i < l; i++) {
      //   polygons[i].setMap(null);
      // }

      // var option = obj[obj.options.selectedIndex]; //通过option的selectedIndex属性，找到当前被选择的index
      // var keyword = option.text; //关键字
      // var adcode = option.adcode;
      district.setLevel(obj.level); //行政区级别
      //extensions 是否返回行政区边界坐标点，默认值：base，不返回行政区边界坐标点，取值：all，返回完整行政区边界坐标点
      district.setExtensions('all'); //这个方法文档中没写，源码如右边 function setExtensions(t) { this.opts.extensions = t}
      //行政区查询
      //按照adcode进行查询可以保证数据返回的唯一性
      district.search(obj.adcode, function (status, result) {
        if (status === 'complete') {
          getData(result.districtList[0], obj.level);
        }
      });
    }

    function setCenter(obj) {
      map.setCenter(obj[obj.options.selectedIndex].center)
    }
  </script>
  <!-- <script type="text/javascript" src="//webapi.amap.com/demos/js/liteToolbar.js"></script> -->

</body>

</html>